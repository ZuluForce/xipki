<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0" xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0" default-activation="lazy">
  <reference id="dataSourceFactory" interface="org.xipki.database.api.DataSourceFactory"/>
  <reference id="passwordResolver" interface="org.xipki.security.api.PasswordResolver"/>
  <reference id="dirPathCompleter" interface="org.xipki.console.karaf.DirPathCompleter"/>
  <reference id="filePathCompleter" interface="org.xipki.console.karaf.FilePathCompleter"/>
  <bean id="logLevelCompleter" class="org.xipki.console.karaf.EnumCompleter">
    <property name="tokens" value="debug,info,warning,severe,off"/>
  </bean>
  
  <command-bundle xmlns="http://karaf.apache.org/xmlns/shell/v1.1.0">
    <command name="dbtool/export-ca">
      <action class="org.xipki.dbi.shell.ExportCaCommand">
        <property name="dataSourceFactory" ref="dataSourceFactory"/>
        <property name="passwordResolver" ref="passwordResolver"/>
      </action>
      <optional-completers>
        <entry key="-outdir" value-ref="dirPathCompleter"/>
        <entry key="-dbconf" value-ref="filePathCompleter"/>
      </optional-completers>
    </command>
    <command name="dbtool/import-ca">
      <action class="org.xipki.dbi.shell.ImportCaCommand">
        <property name="dataSourceFactory" ref="dataSourceFactory"/>
        <property name="passwordResolver" ref="passwordResolver"/>
      </action>
      <optional-completers>
        <entry key="-indir" value-ref="dirPathCompleter"/>
        <entry key="-dbconf" value-ref="filePathCompleter"/>
      </optional-completers>
    </command>
    <command name="dbtool/export-ocsp">
      <action class="org.xipki.dbi.shell.ExportOcspCommand">
        <property name="dataSourceFactory" ref="dataSourceFactory"/>
        <property name="passwordResolver" ref="passwordResolver"/>
      </action>
      <optional-completers>
        <entry key="-outdir" value-ref="dirPathCompleter"/>
        <entry key="-dbconf" value-ref="filePathCompleter"/>
      </optional-completers>
    </command>
    <command name="dbtool/import-ocsp">
      <action class="org.xipki.dbi.shell.ImportOcspCommand">
        <property name="dataSourceFactory" ref="dataSourceFactory"/>
        <property name="passwordResolver" ref="passwordResolver"/>
      </action>
      <optional-completers>
        <entry key="-indir" value-ref="dirPathCompleter"/>
        <entry key="-dbconf" value-ref="filePathCompleter"/>
      </optional-completers>
    </command>
    <command name="dbtool/import-ocspfromca">
      <action class="org.xipki.dbi.shell.ImportOcspFromCaCommand">
        <property name="dataSourceFactory" ref="dataSourceFactory"/>
        <property name="passwordResolver" ref="passwordResolver"/>
      </action>
      <optional-completers>
        <entry key="-indir" value-ref="dirPathCompleter"/>
        <entry key="-dbconf" value-ref="filePathCompleter"/>
      </optional-completers>
    </command>
    <!-- Liquibase Commands -->
    <command name="dbtool/initdb-ca">
      <action class="org.xipki.dbi.shell.InitDbCaCommand"/>
      <optional-completers>
        <entry key="-logLevel" value-ref="logLevelCompleter"/>
      </optional-completers>
    </command>
    <command name="dbtool/initdb-all">
      <action class="org.xipki.dbi.shell.InitDbAllCommand"/>
      <optional-completers>
        <entry key="-logLevel" value-ref="logLevelCompleter"/>
      </optional-completers>
    </command>
    <command name="dbtool/initdb-ocsp">
      <action class="org.xipki.dbi.shell.InitDbOcspCommand"/>
      <optional-completers>
        <entry key="-logLevel" value-ref="logLevelCompleter"/>
      </optional-completers>
    </command>
  </command-bundle>
</blueprint>
