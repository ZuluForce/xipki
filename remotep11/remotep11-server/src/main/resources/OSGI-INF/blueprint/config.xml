<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
	xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0"
	xmlns:ext="http://aries.apache.org/blueprint/xmlns/blueprint-ext/v1.0.0">
	
	<cm:property-placeholder persistent-id="org.xipki.remotep11.server" update-strategy="reload">
		<cm:default-properties>
			<cm:property name="urlPatterns" value="/p11/*"/>
			<cm:property name="pkcs11.password" value="" />
			<cm:property name="pkcs11.includeSlots" value=""/>
			<cm:property name="pkcs11.excludeSlots" value=""/>			
		</cm:default-properties>
	</cm:property-placeholder>
	
		 
    <bean id="localP11CryptService" class="org.xipki.remotep11.server.LocalP11CryptService"
			init-method="init">
        <property name="pkcs11Provider" value="${pkcs11.provider}" />
        <property name="pkcs11Module" value="${pkcs11.module}" />
        <property name="pkcs11Password" value="${pkcs11.password}" />
        <property name="pkcs11IncludeSlots" value="${pkcs11.includeSlots}"/>
        <property name="pkcs11ExcludeSlots" value="${pkcs11.excludeSlots}"/>        
    </bean>
    
	<!-- create the servlet and inject our own app factory -->
    <bean id="serverServlet" class="org.xipki.remotep11.server.Rfc6712Servlet">
        <property name="localP11CryptService" ref="localP11CryptService"/>
     </bean>

    <!-- register it as a servlet service for the web extender -->
    <service ref="serverServlet" interface="javax.servlet.Servlet">
        <service-properties>
            <entry key="urlPatterns" value="${urlPatterns}" />
        </service-properties>
    </service>

</blueprint>
