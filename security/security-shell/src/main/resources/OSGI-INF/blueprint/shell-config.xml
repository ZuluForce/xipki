<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
           xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0"
           default-activation="lazy">

    <reference id="securityFactory" interface="org.xipki.security.api.SecurityFactory" />

	<reference id="filePathCompleter" interface="org.xipki.console.karaf.FilePathCompleter"/>

	<bean id="curveNameCompleter" class="org.xipki.security.shell.completer.ECCurverNameCompleter"/>
	
    <command-bundle xmlns="http://karaf.apache.org/xmlns/shell/v1.1.0">
        <command name="keytool/list">
            <action class="org.xipki.security.shell.P11ListSlotCommand">
            	<property name="securityFactory" ref="securityFactory" />
            </action>
        </command>

        <command name="keytool/rsa">
            <action class="org.xipki.security.shell.P11RSAKeyGenCommand">
            	<property name="securityFactory" ref="securityFactory" />
            </action>
            <optional-completers>
                <entry key="-certout" value-ref="filePathCompleter"/>
            </optional-completers>
        </command>

        <command name="keytool/rsa-p12">
            <action class="org.xipki.security.shell.P12RSAKeyGenCommand">
            	<property name="securityFactory" ref="securityFactory" />
            </action>
            <optional-completers>
                <entry key="-out" value-ref="filePathCompleter"/>
                <entry key="-certout" value-ref="filePathCompleter"/>
            </optional-completers>
        </command>

        <command name="keytool/ec">
            <action class="org.xipki.security.shell.P11ECKeyGenCommand">
            	<property name="securityFactory" ref="securityFactory" />
            </action>
            <optional-completers>
            	<entry key="-curve" value-ref="curveNameCompleter"/>
                <entry key="-certout" value-ref="filePathCompleter"/>
            </optional-completers>
        </command>

        <command name="keytool/ec-p12">
            <action class="org.xipki.security.shell.P12ECKeyGenCommand">
            	<property name="securityFactory" ref="securityFactory" />
            </action>
            <optional-completers>
            	<entry key="-curve" value-ref="curveNameCompleter"/>
                <entry key="-out" value-ref="filePathCompleter"/>
                <entry key="-certout" value-ref="filePathCompleter"/>
            </optional-completers>
        </command>

        <command name="keytool/req">
            <action class="org.xipki.security.shell.P11CertRequestGenCommand">
            	<property name="securityFactory" ref="securityFactory" />
            </action>
            <optional-completers>
                <entry key="-out" value-ref="filePathCompleter"/>
            </optional-completers>
        </command>        

        <command name="keytool/req-p12">
            <action class="org.xipki.security.shell.P12CertRequestGenCommand">
            	<property name="securityFactory" ref="securityFactory" />
            </action>
            <optional-completers>
                <entry key="-out" value-ref="filePathCompleter"/>
                <entry key="-p12" value-ref="filePathCompleter"/>
            </optional-completers>
        </command>

        <command name="keytool/export-cert">
            <action class="org.xipki.security.shell.P11CertExportCommand">
            	<property name="securityFactory" ref="securityFactory" />
            </action>
            <optional-completers>
                <entry key="-out" value-ref="filePathCompleter"/>
            </optional-completers>
        </command>        

        <command name="keytool/export-cert-p12">
            <action class="org.xipki.security.shell.P12CertExportCommand">
            </action>
            <optional-completers>
                <entry key="-out" value-ref="filePathCompleter"/>
                <entry key="-p12" value-ref="filePathCompleter"/>
            </optional-completers>
        </command>        

        <command name="keytool/update-cert">
            <action class="org.xipki.security.shell.P11CertUpdateCommand">
            	<property name="securityFactory" ref="securityFactory" />
            </action>
            <optional-completers>
                <entry key="-cert" value-ref="filePathCompleter"/>
                <entry key="-cacert" value-ref="filePathCompleter"/>
            </optional-completers>
        </command>        

        <command name="keytool/add-cert">
            <action class="org.xipki.security.shell.P11CertAddCommand">
            	<property name="securityFactory" ref="securityFactory" />
            </action>
            <optional-completers>
                <entry key="-cert" value-ref="filePathCompleter"/>
            </optional-completers>
        </command>

        <command name="keytool/rm-cert">
            <action class="org.xipki.security.shell.P11CertDeleteCommand">
            	<property name="securityFactory" ref="securityFactory" />
            </action>
        </command>

        <command name="keytool/update-cert-p12">
            <action class="org.xipki.security.shell.P12CertUpdateCommand">
            	<property name="securityFactory" ref="securityFactory" />
            </action>
            <optional-completers>
                <entry key="-cert" value-ref="filePathCompleter"/>
                <entry key="-cacert" value-ref="filePathCompleter"/>
                <entry key="-p12" value-ref="filePathCompleter"/>
            </optional-completers>
        </command>

        <command name="keytool/delete-key">
            <action class="org.xipki.security.shell.P11KeyDeleteCommand">
            	<property name="securityFactory" ref="securityFactory" />
            </action>
        </command>

        <command name="keytool/pbe-enc">
            <action class="org.xipki.security.shell.PBEEncryptCommand">
            	<property name="securityFactory" ref="securityFactory" />
            </action>
        </command>

        <command name="keytool/pbe-dec">
            <action class="org.xipki.security.shell.PBEDecryptCommand">
            	<property name="securityFactory" ref="securityFactory" />
            </action>
        </command>

        <command name="keytool/extract-cert">
            <action class="org.xipki.security.shell.ExtractCertFromCRLCommand">
            	<property name="securityFactory" ref="securityFactory" />
            </action>
            <optional-completers>
                <entry key="-crl" value-ref="filePathCompleter"/>
                <entry key="-out" value-ref="filePathCompleter"/>
            </optional-completers>
        </command>

    </command-bundle>
    
</blueprint>
